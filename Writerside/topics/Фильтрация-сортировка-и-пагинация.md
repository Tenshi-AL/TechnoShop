# Фильтрация, сортировка и пагинация
В этом разделе описан весь путь, который проходит модель от базы данных и до пользователя.
Всё это будет описано на примере GPU.

Первым делом список извлекается и базы данных и через сервис отдаётся
пользователю:
```c#
public async Task<IEnumerable<GPU>> List(CancellationToken cancellationToken = default) =>
        await db.Gpus
            .AsNoTracking()
            .Include(p => p.Manufacturer)
            .Include(p => p.MemoryType)
            .Include(p => p.Brand)
            .ToListAsync(cancellationToken);
```

Далее список будет получен в контроллере, с помощью вышеописанного метода:
```c#
var list = await gpuService.List(cancellationToken);
```
Следующим шагом полученный список **фильтруется** и **сортируется**, и **маппится** в **readDto** модель:
```c#
var mappedList = mapper.Map<List<GpuReadDto>>(list
            .Filter(parameters)
            .Order(parameters));
```
Далее создаётся модель для отображения пользователю, которая содержит все 
необходимые метаданные для клиента и которая обрезает (пагинует) уже полученный список, сам код модели:
```C#
public sealed class ListResponce<T>
{
    public ListResponce(IEnumerable<T> source, int pageIndex, int pageSize)
    {
        TotalCount = source.Count();
        TotalPages = (int)Math.Ceiling(TotalCount / (double)pageSize);
        PageIndex = pageIndex;
        PageSize = pageSize;
        HasPreviousPage = pageIndex > 1;
        HasNextPage = PageIndex < TotalPages;
        List = source.Skip((pageIndex - 1) * pageSize).Take(pageSize);
    }

    public IEnumerable<T> List { get; private set; }
    public int TotalCount { get; private set; } 
    public int TotalPages { get; private set; } 
    public int PageIndex { get; private set; }
    public int PageSize { get; private set; }
    public bool HasPreviousPage { get; private set; }
    public bool HasNextPage { get; private set; }
}
```
Эта модель принимает любой список, любых типов, соответственно подходит для пагинации любых данных.
В конечном итоге данные возвращаются пользователю:
```c#
return Ok(new ListResponce<GpuReadDto>(mappedList, parameters.Page, parameters.PageSize));
```